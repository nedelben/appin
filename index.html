<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>استبيان: تجربة التنقل والعنونة</title>
  <style>
    :root{--bg:#0b1220;--card:#0f1724;--muted:#9aa4b2;--accent:#06b6d4;--glass:rgba(255,255,255,0.03);--radius:14px;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#061528,#071224);color:#eaf2fb;display:flex;align-items:center;justify-content:center;padding:20px}
    .frame{width:100%;max-width:760px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:22px;border-radius:18px;box-shadow:0 10px 40px rgba(2,6,23,0.7)}
    h1{margin:0 0 8px;font-size:20px;text-align:center}
    p.lead{margin:0 0 18px;text-align:center;color:var(--muted)}

    .progress-wrap{height:12px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden;margin-bottom:18px}
    .progress{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#60a5fa)}

    .welcome,.thanks{display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;text-align:center}
    .thanks{display:none}

    .btn{display:inline-flex;align-items:center;gap:8px;border-radius:10px;padding:10px 16px;font-weight:700;cursor:pointer;border:none}
    .btn.primary{background:var(--accent);color:#012}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .btn.secondary:hover{background:rgba(255,255,255,0.02)}
    .btn.primary:hover{filter:brightness(1.03)}

    form{display:flex;flex-direction:column;gap:14px}
    .q{display:none;gap:10px;flex-direction:column}
    .q.active{display:flex}
    label{font-weight:700}
    input[type=text], input[type=email], select, textarea, input[type=number]{padding:10px;border-radius:8px;border:none;background:var(--glass);color:inherit;width:100%}
    .choices{display:flex;flex-wrap:wrap;gap:10px}
    .choices label{background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:8px;cursor:pointer}
    textarea{min-height:80px}

    .nav{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:8px}
    .small{color:var(--muted);font-size:13px}

    @media (max-width:600px){.frame{padding:16px}h1{font-size:18px}}
  </style>
</head>
<body>
  <div class="frame" role="main">
    <h1>استبيان: التنقل ومعرفة الأماكن</h1>
    <p class="lead">نريد أن نعرف تجربتك في التنقل داخل مدينتك وصعوبة إيجاد الشوارع والأماكن. الاستبيان عام وسيأخذ أقل من 3 دقائق.</p>

    <div class="progress-wrap" aria-hidden="true"><div class="progress" id="progress"></div></div>

    <!-- Welcome screen -->
    <div id="welcome" class="welcome">
      <p>مرحبًا! شكراً لوقتك. هذا الاستبيان جزء من بحث لفهم تحديات التنقل والعثور على الأماكن داخل المدن. إجاباتك ستساعدنا على تحديد المشاكل الحقيقية واقتراح حلول أفضل.</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
        <button id="startBtn" class="btn primary">ابدأ الاستبيان</button>
        <button id="infoBtn" class="btn secondary">لماذا أشارك؟</button>
        <button id="authorsBtn" class="btn secondary">منظمو الاستبيان</button>
      </div>
      <p class="small">ستُطلب بعض المعلومات الأساسية (السن، البريد، الاسم) أثناء الاستبيان لتصنيف الإجابات والتواصل في حال رغبت بذلك.</p>
    </div>

    <!-- Main form -->
    <form id="survey" hidden>
      <!-- الأسئلة ... (نفس أسئلتك السابقة) -->
      <div class="q active" data-q="1">
        <label>1. ما اسم مدينتك الحالية؟</label>
        <input type="text" name="city" placeholder="مثال: الجزائر، وهران..." required />
      </div>
      <!-- ... باقي الأسئلة لغاية السؤال 16 ... -->
      <div class="q" data-q="16">
        <label>16. اسمك الكامل</label>
        <input type="text" name="full_name" placeholder="الاسم الكامل" required />
      </div>

      <div class="nav">
        <button type="button" id="prev" class="btn secondary">السابق</button>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="small">سؤال <span id="stepNum">1</span> / 16</div>
          <button type="button" id="next" class="btn primary">التالي</button>
        </div>
      </div>
    </form>

    <!-- Thanks screen -->
    <div id="thanks" class="thanks">
      <h2>شكراً لمشاركتك!</h2>
      <p class="lead">🙏 سنرسل لك لاحقاً تفاصيل حول منتجنا في حالة توفره.</p>
      <div style="margin-top:16px;text-align:right">
        <h3>منظمو الاستبيان</h3>
        <ul style="list-style:none;padding:0;line-height:1.7;margin:0">
          <li>benyak nadal – Université de Médéa</li>
          <li>Asmahan Belkacemi – University of Algiers 1</li>
          <li>Khaled Bouchenafa – University of Algiers 1</li>
          <li>Amar Kadri – University of Oran 2</li>
          <li>Ahlam Minasri – University of Oran 2</li>
        </ul>
      </div>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
        <button id="restartBtn" class="btn secondary">أعد الاستبيان</button>
      </div>
    </div>
  </div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const infoBtn = document.getElementById('infoBtn');
    const authorsBtn = document.getElementById('authorsBtn');
    const welcome = document.getElementById('welcome');
    const form = document.getElementById('survey');
    const qs = Array.from(document.querySelectorAll('.q'));
    const prev = document.getElementById('prev');
    const next = document.getElementById('next');
    const stepNum = document.getElementById('stepNum');
    const progress = document.getElementById('progress');
    const thanks = document.getElementById('thanks');
    const restartBtn = document.getElementById('restartBtn');

    let idx = 0;

    startBtn.addEventListener('click', ()=>{
      welcome.style.display = 'none';
      form.hidden = false;
      update();
    });
    infoBtn.addEventListener('click', ()=>alert('الاستبيان يهدف إلى فهم تجربة التنقل ومعرفة المواقع داخل المدن (شوارع، أماكن وخدمات داخل المباني). وقت الإجابة أقل من 3 دقائق.'));
    authorsBtn.addEventListener('click', ()=>alert('منظمو الاستبيان:\n• benyak nadal – Université de Médéa\n• Asmahan Belkacemi – University of Algiers 1\n• Khaled Bouchenafa – University of Algiers 1\n• Amar Kadri – University of Oran 2\n• Ahlam Minasri – University of Oran 2'));

    prev.addEventListener('click', ()=>{ if(idx>0){idx--;update()} });
    next.addEventListener('click', async ()=>{
      const currentQ = qs[idx];
      const inputs = currentQ.querySelectorAll('input,select,textarea');
      for(const el of inputs){
        if(el.hasAttribute('required') && !el.checkValidity()){
          el.reportValidity();
          return;
        }
      }
      if(idx < qs.length-1){ idx++; update(); }
      else { await submitResponses(); }
    });

    function update(){
      qs.forEach((q,i)=>q.classList.toggle('active', i===idx));
      prev.disabled = idx===0;
      next.textContent = (idx===qs.length-1)? 'إرسال الإجابات' : 'التالي';
      stepNum.textContent = idx+1;
      progress.style.width = Math.round(((idx+1)/qs.length)*100)+'%';
    }

    async function submitResponses(){
      const formData = {};
      new FormData(form).forEach((value, key) => formData[key] = value);

      try {
        await fetch("https://script.google.com/macros/s/AKfycbwyfAsjkIBHpGBWAGXZW7jYVuMg2QMIAnXBHpcet9kaqHLIuMQ9rqMIUvvU17IUfAdO0w/exec", {
          method: "POST",
          body: JSON.stringify(formData),
          headers: {"Content-Type": "application/json"}
        });
        form.hidden = true;
        thanks.style.display = 'flex';
      } catch (err) {
        alert("حدث خطأ أثناء إرسال البيانات، حاول مرة أخرى.");
        console.error(err);
      }
    }

    restartBtn.addEventListener('click', ()=>{
      thanks.style.display='none';
      form.hidden = false; idx = 0; update();
    });
  </script>
</body>
</html>
